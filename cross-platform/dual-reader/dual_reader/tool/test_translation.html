<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Translation Test - LibreTranslate API</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    .status {
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      font-weight: bold;
      text-align: center;
    }
    .status.ready { background: #e3f2fd; color: #1976d2; }
    .status.success { background: #d4edda; color: #155724; }
    .status.error { background: #f8d7da; color: #721c24; }
    .status.loading { background: #fff3cd; color: #856404; }
    .result-box {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      margin: 15px 0;
      min-height: 100px;
    }
    .history-item {
      background: #f8f9fa;
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
      border-left: 4px solid #4CAF50;
    }
    .history-item.error {
      border-left-color: #dc3545;
    }
    input, select, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover:not(:disabled) {
      background: #45a049;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .test-button {
      background: #2196F3;
    }
    .test-button:hover:not(:disabled) {
      background: #0b7dda;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üåê Translation Test - LibreTranslate API</h1>

    <div id="status" class="status ready">
      ‚úÖ Ready - Testing LibreTranslate Free API
    </div>

    <div>
      <label><strong>Enter English text:</strong></label>
      <input type="text" id="inputText" value="Hello world" placeholder="Type English text here...">
    </div>

    <div>
      <label><strong>Target Language:</strong></label>
      <select id="targetLanguage">
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="it">Italian</option>
        <option value="pt">Portuguese</option>
        <option value="ru">Russian</option>
        <option value="bg">Bulgarian</option>
        <option value="zh">Chinese</option>
        <option value="ja">Japanese</option>
      </select>
    </div>

    <button onclick="translateText()" id="translateBtn">üåç Translate</button>
    <button onclick="runAllTests()" class="test-button" id="testBtn">‚úÖ Run All Tests</button>

    <div class="result-box">
      <strong>Translation Result:</strong>
      <div id="result" style="margin-top: 10px; font-size: 18px;">
        Translation will appear here...
      </div>
      <div id="timing" style="margin-top: 10px; color: #666; font-size: 14px;"></div>
    </div>

    <div id="history" style="margin-top: 20px;">
      <h3>Test History:</h3>
    </div>
  </div>

  <script>
    // Try multiple LibreTranslate API endpoints for better reliability
    const API_ENDPOINTS = [
      'https://translate.argosopentech.com/translate',
      'https://libretranslate.com/translate',
      'https://translate.terraprint.co/translate'
    ];

    let currentEndpoint = 0;

    async function translateWithFallback(text, source, target, format = 'text') {
      for (let i = 0; i < API_ENDPOINTS.length; i++) {
        const endpoint = API_ENDPOINTS[(currentEndpoint + i) % API_ENDPOINTS.length];
        try {
          console.log(`Trying endpoint: ${endpoint}`);
          const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              q: text,
              source: source,
              target: target,
              format: format,
            }),
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();
          if (data.translatedText) {
            return data.translatedText;
          }
          throw new Error('No translation returned');
        } catch (error) {
          console.warn(`Endpoint ${endpoint} failed:`, error.message);
          if (i === API_ENDPOINTS.length - 1) {
            throw error; // All endpoints failed
          }
        }
      }
    }

    async function translateText() {
      const input = document.getElementById('inputText').value;
      const targetLang = document.getElementById('targetLanguage').value;
      const status = document.getElementById('status');
      const result = document.getElementById('result');
      const timing = document.getElementById('timing');
      const btn = document.getElementById('translateBtn');

      if (!input.trim()) {
        status.className = 'status error';
        status.textContent = '‚ùå Please enter some text';
        return;
      }

      status.className = 'status loading';
      status.textContent = '‚è≥ Translating...';
      btn.disabled = true;
      result.textContent = 'Loading...';
      timing.textContent = '';

      const startTime = Date.now();

      try {
        const translatedText = await translateWithFallback(input, 'en', targetLang);
        const duration = Date.now() - startTime;

        result.textContent = translatedText;
        timing.textContent = `‚è±Ô∏è Time: ${duration}ms`;
        status.className = 'status success';
        status.textContent = `‚úÖ Success! (${duration}ms)`;
        addToHistory(input, translatedText, targetLang, duration, true);
      } catch (error) {
        const duration = Date.now() - startTime;
        console.error('Translation error:', error);
        status.className = 'status error';
        status.textContent = `‚ùå Error: ${error.message}`;
        result.textContent = `Translation failed: ${error.message}`;
        timing.textContent = `‚è±Ô∏è Time: ${duration}ms`;
        addToHistory(input, error.message, targetLang, duration, false);
      } finally {
        btn.disabled = false;
      }
    }

    async function runAllTests() {
      const tests = [
        { text: 'Hello', lang: 'es', name: 'Spanish' },
        { text: 'Thank you', lang: 'es', name: 'Spanish' },
        { text: 'Goodbye', lang: 'fr', name: 'French' },
        { text: 'How are you?', lang: 'es', name: 'Spanish' },
      ];

      const status = document.getElementById('status');
      const testBtn = document.getElementById('testBtn');

      status.className = 'status loading';
      status.textContent = '‚è≥ Running automated tests...';
      testBtn.disabled = true;

      document.getElementById('history').innerHTML = '<h3>Test History:</h3>';

      let successCount = 0;
      let failCount = 0;

      for (let i = 0; i < tests.length; i++) {
        const test = tests[i];
        const startTime = Date.now();

        try {
          const translatedText = await translateWithFallback(test.text, 'en', test.lang);
          const duration = Date.now() - startTime;

          addToHistory(
            `"${test.text}" ‚Üí "${translatedText}"`,
            test.name,
            test.lang,
            duration,
            true
          );
          successCount++;
        } catch (error) {
          const duration = Date.now() - startTime;
          addToHistory(`"${test.text}" ‚Üí ${error.message}`, test.name, test.lang, duration, false);
          failCount++;
        }
      }

      status.className = successCount === tests.length ? 'status success' : 'status error';
      status.textContent = `‚úÖ Tests complete! ${successCount}/${tests.length} passed, ${failCount} failed`;
      testBtn.disabled = false;
    }

    function addToHistory(input, output, lang, time, success) {
      const history = document.getElementById('history');
      const item = document.createElement('div');
      item.className = 'history-item' + (success ? '' : ' error');
      item.innerHTML = `
        <strong>${success ? '‚úÖ' : '‚ùå'} ${lang.toUpperCase()}</strong><br>
        Input: "${typeof input === 'string' ? input.substring(0, 50) : input}"<br>
        ${success ? 'Output: "' + output + '"' : 'Error: ' + output}<br>
        <small>Time: ${time}ms</small>
      `;
      history.appendChild(item);
    }

    // Allow Enter key to trigger translation
    document.getElementById('inputText').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        translateText();
      }
    });
  </script>
</body>
</html>
